# Copyright (c) Qualcomm Technologies, Inc. and/or its subsidiaries.
# SPDX-License-Identifier: BSD-3-Clause-Clear

# yaml-language-server: $schema=../../../../schemas/inst_schema.json
<%- 
  raise "'n' must be defined as an integer between 0 and 7" unless (0..7).include?(n)

  # Encoding for mop.rr.n:
  # Original match pattern: 1-00--1----------100-----1110011 (32 bits)
  # Variable 'n' is encoded in bits: 30|27-26
  # Bit 30: n[2], Bits 27-26: n[1:0]
  
  bit_30 = (n >> 2) & 1        # n[2]
  bit_27 = (n >> 1) & 1        # n[1]
  bit_26 = n & 1               # n[0]
  
  # Build the 32-bit match string:
  # Bits: 31  30  29-28 27  26  25-20          19-15    14-12 11-7     6-0
  #       1   n2  00    n1  n0  1-----         -----    100   -----    1110011
  match = "1#{bit_30}00#{bit_27}#{bit_26}1----------100-----1110011"
-%>

$schema: "inst_schema.json#"
kind: instruction
name: mop.rr.<%= n %>
long_name: May-be-operation <%= n %> (2 source registers)
description: |
  The Zimop extension defines 8 MOP instructions named MOP.RR.n, where n is an integer between 0
  and 7, inclusive. Unless redefined by another extension, this instruction simply writes 0 to X[xd].
  Its encoding allows future extensions to define it to read X[xs1] and X[xs2], as well as write X[xd].
  
  This is mop.rr.<%= n %> from the MOP.RR instruction family (n=<%= n %>).
definedBy:
  extension:
    name: Zimop
assembly: xd, xs1, xs2
encoding:
  match: <%= match %>
  variables:
    - name: xs2
      location: 24-20
    - name: xs1
      location: 19-15
    - name: xd
      location: 11-7
access:
  s: always
  u: always
  vs: always
  vu: always
data_independent_timing: false
operation(): |
  X[xd] = 0;
